<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V60 Recipe Calculator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --espresso: #3E2723;
      --dark-brown: #4E342E;
      --medium-brown: #5D4037;
      --accent: #8D6E63;
      --light-accent: #A1887F;
      --cream: #EFEBE9;
      --cream-light: #FAF7F5;
      --highlight-bg: #FFF3E0;
      --highlight-border: #FF9800;
      --selected-bg: #E3F2FD;
      --selected-border: #1976D2;
      --text-primary: #3E2723;
      --text-secondary: #5D4037;
      --white: #FFFFFF;
      --green-light: #E8F5E9;
      --green-border: #66BB6A;
      --green-text: #2E7D32;
      --shadow: 0 2px 8px rgba(62, 39, 35, 0.12);
      --shadow-lg: 0 4px 16px rgba(62, 39, 35, 0.16);
      --radius: 12px;
      --radius-sm: 8px;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--cream-light);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: linear-gradient(135deg, var(--espresso), var(--dark-brown));
      color: var(--white);
      padding: 2rem 1rem;
      text-align: center;
    }

    header h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      letter-spacing: -0.02em;
    }

    header p {
      font-size: 0.95rem;
      opacity: 0.85;
      font-weight: 400;
    }

    header a {
      color: var(--cream);
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    header a:hover {
      opacity: 0.9;
    }

    main {
      flex: 1;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 1.5rem 1rem 2rem;
    }

    /* Brew Steps */
    .brew-steps {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.25rem 1.5rem;
      margin-bottom: 1.5rem;
    }

    .brew-steps-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .brew-steps-header h2 {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--espresso);
    }

    .brew-selected-recipe {
      font-size: 0.8rem;
      color: var(--accent);
      font-weight: 500;
    }

    .brew-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-reset-brew {
      font-family: 'Inter', sans-serif;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.35rem 0.75rem;
      border-radius: 6px;
      border: 1.5px solid var(--accent);
      background: var(--white);
      color: var(--accent);
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-reset-brew:hover {
      background: var(--cream);
    }

    .steps-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem;
    }

    .step {
      background: var(--cream);
      border-radius: var(--radius-sm);
      padding: 0.75rem 1rem;
      text-align: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
      user-select: none;
      position: relative;
    }

    .step.available {
      border-color: var(--accent);
      cursor: pointer;
    }

    .step.available:hover {
      background: #F5EFEB;
      box-shadow: 0 2px 8px rgba(141, 110, 99, 0.2);
    }

    .step.locked {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .step.running {
      border-color: var(--highlight-border);
      background: var(--highlight-bg);
      animation: pulse-border 1.5s ease-in-out infinite;
    }

    @keyframes pulse-border {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.3); }
      50% { box-shadow: 0 0 0 6px rgba(255, 152, 0, 0); }
    }

    .step.completed {
      background: var(--green-light);
      border-color: var(--green-border);
    }

    .step.completed .step-label {
      color: var(--green-text);
    }

    .step.completed .step-timer {
      color: var(--green-text);
    }

    .step-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--accent);
      margin-bottom: 0.25rem;
    }

    .step-detail {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .step-detail strong {
      color: var(--espresso);
    }

    .step-timer {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--espresso);
      margin-top: 0.4rem;
      font-variant-numeric: tabular-nums;
    }

    .step-hint {
      font-size: 0.65rem;
      color: var(--light-accent);
      margin-top: 0.3rem;
      font-weight: 500;
    }

    .step.completed .step-hint {
      color: var(--green-text);
      opacity: 0.7;
    }

    .step.running .step-hint {
      color: var(--highlight-border);
    }

    /* Brew completion animation */
    .steps-grid.fade-out {
      animation: fadeOut 0.6s ease forwards;
    }

    @keyframes fadeOut {
      to { opacity: 0; transform: translateY(-10px); }
    }

    .brew-complete {
      display: none;
      text-align: center;
      padding: 2rem 1rem;
      opacity: 0;
      transform: translateY(10px);
    }

    .brew-complete.show {
      display: block;
      animation: fadeIn 0.6s ease 0.5s forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; transform: translateY(0); }
    }

    .brew-complete .brew-complete-icon {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }

    .brew-complete .brew-complete-text {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--green-text);
    }

    /* No recipe selected prompt */
    .no-recipe-notice {
      text-align: center;
      padding: 0.75rem;
      font-size: 0.8rem;
      color: var(--light-accent);
      font-style: italic;
    }

    /* Slider Section */
    .slider-section {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.25rem 1.5rem;
      margin-bottom: 1.5rem;
    }

    .slider-section h2 {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--espresso);
    }

    .slider-wrapper {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .slider-wrapper label {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .slider-track-container {
      flex: 1;
      position: relative;
    }

    .slider-track-container input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      border-radius: 3px;
      background: var(--cream);
      outline: none;
      cursor: pointer;
    }

    .slider-track-container input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 2px 6px rgba(62, 39, 35, 0.3);
      cursor: pointer;
      transition: background 0.15s;
    }

    .slider-track-container input[type="range"]::-webkit-slider-thumb:hover {
      background: var(--medium-brown);
    }

    .slider-track-container input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 2px 6px rgba(62, 39, 35, 0.3);
      cursor: pointer;
      border: none;
      transition: background 0.15s;
    }

    .slider-track-container input[type="range"]::-moz-range-thumb:hover {
      background: var(--medium-brown);
    }

    .ratio-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--espresso);
      min-width: 52px;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    .slider-bottom-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.35rem;
      padding: 0 0.1rem;
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      flex: 1;
    }

    .slider-labels span {
      font-size: 0.7rem;
      color: var(--light-accent);
      font-weight: 500;
    }

    .btn-reset-ratio {
      font-family: 'Inter', sans-serif;
      font-size: 0.7rem;
      font-weight: 600;
      padding: 0.2rem 0.6rem;
      border-radius: 5px;
      border: 1.5px solid var(--highlight-border);
      background: var(--highlight-bg);
      color: var(--highlight-border);
      cursor: pointer;
      transition: all 0.15s;
      white-space: nowrap;
      margin-left: 0.75rem;
    }

    .btn-reset-ratio:hover {
      background: #FFE0B2;
    }

    .btn-reset-ratio.hidden {
      visibility: hidden;
    }

    /* Table Section */
    .table-section {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 1.5rem;
    }

    .table-section h2 {
      font-size: 1.1rem;
      font-weight: 600;
      padding: 1.25rem 1.5rem 0.25rem;
      color: var(--espresso);
    }

    .table-hint {
      padding: 0 1.5rem 0.75rem;
      font-size: 0.75rem;
      color: var(--light-accent);
    }

    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      min-width: 500px;
    }

    thead {
      background: var(--cream);
    }

    thead th {
      padding: 0.75rem 1rem;
      text-align: right;
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--accent);
      white-space: nowrap;
    }

    thead th:first-child {
      text-align: left;
    }

    tbody td {
      padding: 0.65rem 1rem;
      text-align: right;
      border-bottom: 1px solid var(--cream);
      font-variant-numeric: tabular-nums;
    }

    tbody td:first-child {
      text-align: left;
      font-weight: 600;
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    tbody tr {
      cursor: pointer;
      transition: background-color 0.1s;
    }

    tbody tr:hover {
      background-color: var(--cream-light);
    }

    tbody tr.highlight {
      background-color: var(--highlight-bg);
      font-weight: 600;
    }

    tbody tr.highlight td {
      border-bottom-color: #FFE0B2;
    }

    tbody tr.highlight td:first-child {
      position: relative;
    }

    tbody tr.highlight td:first-child::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--highlight-border);
      border-radius: 0 2px 2px 0;
    }

    tbody tr.selected {
      background-color: var(--selected-bg);
      font-weight: 600;
    }

    tbody tr.selected td {
      border-bottom-color: #BBDEFB;
    }

    tbody tr.selected td:first-child {
      position: relative;
    }

    tbody tr.selected td:first-child::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--selected-border);
      border-radius: 0 2px 2px 0;
    }

    tbody tr.highlight.selected {
      background: linear-gradient(90deg, var(--selected-bg) 0%, var(--highlight-bg) 100%);
    }

    tbody tr.highlight.selected td:first-child::before {
      background: linear-gradient(180deg, var(--selected-border), var(--highlight-border));
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 1.5rem 1rem;
      font-size: 0.8rem;
      color: var(--light-accent);
      border-top: 1px solid var(--cream);
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 480px) {
      header {
        padding: 1.5rem 1rem;
      }

      header h1 {
        font-size: 1.4rem;
      }

      main {
        padding: 1rem 0.75rem 1.5rem;
      }

      .brew-steps, .slider-section {
        padding: 1rem 1.15rem;
      }

      .steps-grid {
        grid-template-columns: 1fr 1fr;
      }

      table {
        font-size: 0.8rem;
      }

      thead th, tbody td {
        padding: 0.6rem 0.65rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>â˜• V60 Recipe Calculator</h1>
    <p>Based on <a href="https://www.youtube.com/watch?v=1oB1oDrDkHM" target="_blank" rel="noopener">James Hoffmann's Ultimate V60 Technique</a></p>
  </header>

  <main>
    <section class="brew-steps">
      <div class="brew-steps-header">
        <div>
          <h2>Brew Steps</h2>
          <div class="brew-selected-recipe" id="brewRecipeLabel">Select a recipe from the table below</div>
        </div>
        <div class="brew-actions">
          <button type="button" class="btn-reset-brew" id="btnResetBrew" title="Reset all brew steps">Reset</button>
        </div>
      </div>
      <div id="noRecipeNotice" class="no-recipe-notice">
        ðŸ‘‡ Tap a row in the recipe table to load a brew
      </div>
      <div class="steps-grid" id="stepsGrid" style="display:none;">
        <div class="step locked" id="step0" data-step="0">
          <div class="step-label">1 â€” Bloom</div>
          <div class="step-detail" id="step0Detail">Pour <strong>--g</strong> water<br>Wait 45s, swirl</div>
          <div class="step-timer" id="step0Timer">0:00</div>
          <div class="step-hint" id="step0Hint"></div>
        </div>
        <div class="step locked" id="step1" data-step="1">
          <div class="step-label">2 â€” Pour 1</div>
          <div class="step-detail" id="step1Detail">Pour to <strong>--g</strong><br>by <strong>1:15</strong></div>
          <div class="step-timer" id="step1Timer">0:00</div>
          <div class="step-hint" id="step1Hint"></div>
        </div>
        <div class="step locked" id="step2" data-step="2">
          <div class="step-label">3 â€” Pour 2</div>
          <div class="step-detail" id="step2Detail">Pour to <strong>--g</strong><br>by <strong>1:45</strong></div>
          <div class="step-timer" id="step2Timer">0:00</div>
          <div class="step-hint" id="step2Hint"></div>
        </div>
        <div class="step locked" id="step3" data-step="3">
          <div class="step-label">4 â€” Finish</div>
          <div class="step-detail" id="step3Detail">Swirl &amp; drain<br>Target <strong>~3:30</strong></div>
          <div class="step-timer" id="step3Timer">0:00</div>
          <div class="step-hint" id="step3Hint"></div>
        </div>
      </div>
      <div class="brew-complete" id="brewComplete">
        <div class="brew-complete-icon">â˜•</div>
        <div class="brew-complete-text">Enjoy your brew</div>
      </div>
    </section>

    <section class="slider-section">
      <h2>Coffee-to-Water Ratio</h2>
      <div class="slider-wrapper">
        <label for="ratioSlider">1 :</label>
        <div class="slider-track-container">
          <input type="range" id="ratioSlider" min="14" max="18" step="0.1" value="16.7">
        </div>
        <span class="ratio-value" id="ratioDisplay">1:16.7</span>
      </div>
      <div class="slider-bottom-row">
        <div class="slider-labels">
          <span>1:14 (stronger)</span>
          <span>1:18 (lighter)</span>
        </div>
        <button type="button" class="btn-reset-ratio hidden" id="btnResetRatio">Reset to 1:16.7</button>
      </div>
    </section>

    <section class="table-section">
      <h2>Recipe Reference Table</h2>
      <p class="table-hint">Tap a row to load it into the brew steps above</p>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th scope="col">Water (g)</th>
              <th scope="col">Coffee (g)</th>
              <th scope="col">Bloom (g)</th>
              <th scope="col">Pour 1 to (g)</th>
              <th scope="col">Pour 2 to (g)</th>
            </tr>
          </thead>
          <tbody id="recipeTableBody">
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    Recipe by <a href="https://www.youtube.com/watch?v=1oB1oDrDkHM" target="_blank" rel="noopener">James Hoffmann</a> Â· Built by <a href="https://github.com/DevSecNinja" target="_blank" rel="noopener">DevSecNinja</a>
  </footer>

  <script>
    // --- Constants ---
    const DEFAULT_RATIO = 16.7;
    const STEP_COUNT = 4;

    // --- DOM refs ---
    const slider = document.getElementById('ratioSlider');
    const ratioDisplay = document.getElementById('ratioDisplay');
    const tableBody = document.getElementById('recipeTableBody');
    const btnResetRatio = document.getElementById('btnResetRatio');

    const stepsGrid = document.getElementById('stepsGrid');
    const noRecipeNotice = document.getElementById('noRecipeNotice');
    const brewRecipeLabel = document.getElementById('brewRecipeLabel');
    const btnResetBrew = document.getElementById('btnResetBrew');

    // --- Brew state ---
    let selectedRecipe = null; // { water, coffee, bloom, pour1, pour2 }
    let stepStates = []; // 'locked' | 'available' | 'running' | 'completed'
    let stepTimers = []; // interval IDs
    let stepStartTimes = []; // timestamps
    let stepRemaining = []; // remaining seconds (countdown)

    // Step durations in seconds: Bloom 45s, Pour 1 30s, Pour 2 30s, Drain 105s
    const STEP_DURATIONS = [45, 30, 30, 105];

    // --- Slider snap to default ---
    function handleSliderInput() {
      let val = parseFloat(slider.value);
      // Sticky: snap to default if within Â±0.2
      if (Math.abs(val - DEFAULT_RATIO) < 0.1) {
        val = DEFAULT_RATIO;
        slider.value = DEFAULT_RATIO;
      }
      ratioDisplay.textContent = '1:' + val.toFixed(1);
      btnResetRatio.classList.toggle('hidden', val === DEFAULT_RATIO);
      generateTable(val);
    }

    function resetRatio() {
      slider.value = DEFAULT_RATIO;
      handleSliderInput();
    }

    // --- Table generation (10g increments) ---
    function generateTable(ratio) {
      let html = '';
      for (let water = 100; water <= 500; water += 10) {
        const coffee = (water / ratio).toFixed(1);
        const bloom = (parseFloat(coffee) * 2).toFixed(0);
        const pour1 = (water * 0.6).toFixed(0);
        const pour2 = water;
        const isHighlight = water === 250;
        const isSelected = selectedRecipe && selectedRecipe.water === water;

        let classes = [];
        if (isHighlight) classes.push('highlight');
        if (isSelected) classes.push('selected');

        html += `<tr class="${classes.join(' ')}" data-water="${water}" data-coffee="${coffee}" data-bloom="${bloom}" data-pour1="${pour1}" data-pour2="${pour2}">
          <td>${water}g</td>
          <td>${coffee}g</td>
          <td>${bloom}g</td>
          <td>${pour1}g</td>
          <td>${pour2}g</td>
        </tr>`;
      }
      tableBody.innerHTML = html;

      // Attach row click handlers
      tableBody.querySelectorAll('tr').forEach(row => {
        row.addEventListener('click', () => selectRecipe(row));
      });
    }

    // --- Select a recipe row ---
    function selectRecipe(row) {
      const water = parseInt(row.dataset.water);
      const coffee = row.dataset.coffee;
      const bloom = row.dataset.bloom;
      const pour1 = row.dataset.pour1;
      const pour2 = row.dataset.pour2;

      selectedRecipe = { water, coffee, bloom, pour1, pour2 };

      // Update table highlight
      tableBody.querySelectorAll('tr.selected').forEach(r => r.classList.remove('selected'));
      row.classList.add('selected');

      // Show steps grid, hide notice
      noRecipeNotice.style.display = 'none';
      stepsGrid.style.display = '';

      // Update recipe label
      brewRecipeLabel.textContent = `Brewing ${water}g water / ${coffee}g coffee`;

      // Update step details with recipe values
      document.getElementById('step0Detail').innerHTML = `Pour <strong>${bloom}g</strong> water<br>Wait 45s, swirl`;
      document.getElementById('step1Detail').innerHTML = `Pour to <strong>${pour1}g</strong> total<br>by <strong>1:15</strong>`;
      document.getElementById('step2Detail').innerHTML = `Pour to <strong>${pour2}g</strong> total<br>by <strong>1:45</strong>`;
      document.getElementById('step3Detail').innerHTML = `Swirl &amp; drain<br>Target <strong>~3:30</strong>`;

      // Reset brew state
      resetBrewState();
    }

    // --- Brew step logic ---
    function resetBrewState() {
      // Clear all timers
      for (let i = 0; i < STEP_COUNT; i++) {
        if (stepTimers[i]) clearInterval(stepTimers[i]);
      }
      stepTimers = new Array(STEP_COUNT).fill(null);
      stepStartTimes = new Array(STEP_COUNT).fill(null);
      stepRemaining = STEP_DURATIONS.slice(); // copy durations as initial countdown
      stepStates = new Array(STEP_COUNT).fill('locked');

      // First step is available
      if (selectedRecipe) {
        stepStates[0] = 'available';
      }

      // Hide completion message, restore steps grid
      stepsGrid.classList.remove('fade-out');
      document.getElementById('brewComplete').classList.remove('show');

      renderSteps();
    }

    function renderSteps() {
      for (let i = 0; i < STEP_COUNT; i++) {
        const el = document.getElementById('step' + i);
        const timerEl = document.getElementById('step' + i + 'Timer');
        const hintEl = document.getElementById('step' + i + 'Hint');

        el.className = 'step ' + stepStates[i];
        timerEl.textContent = formatTime(Math.max(0, stepRemaining[i]));

        switch (stepStates[i]) {
          case 'locked':
            hintEl.textContent = '';
            break;
          case 'available':
            hintEl.textContent = 'â–¶ Tap to start';
            break;
          case 'running':
            hintEl.textContent = 'â± Tap to skip';
            break;
          case 'completed':
            hintEl.textContent = 'âœ“ Done';
            break;
        }
      }
    }

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return m + ':' + String(s).padStart(2, '0');
    }

    function completeStep(stepIndex) {
      clearInterval(stepTimers[stepIndex]);
      stepTimers[stepIndex] = null;
      stepRemaining[stepIndex] = 0;
      stepStates[stepIndex] = 'completed';

      // Unlock next step
      if (stepIndex + 1 < STEP_COUNT) {
        stepStates[stepIndex + 1] = 'available';
      }
      renderSteps();

      // Check if all steps completed
      if (stepStates.every(s => s === 'completed')) {
        showBrewComplete();
      }
    }

    function showBrewComplete() {
      stepsGrid.classList.add('fade-out');
      document.getElementById('brewComplete').classList.add('show');
    }

    function handleStepClick(stepIndex) {
      const state = stepStates[stepIndex];

      if (state === 'available') {
        // Start countdown
        stepStates[stepIndex] = 'running';
        stepStartTimes[stepIndex] = Date.now();
        const duration = stepRemaining[stepIndex];
        stepTimers[stepIndex] = setInterval(() => {
          const elapsed = (Date.now() - stepStartTimes[stepIndex]) / 1000;
          stepRemaining[stepIndex] = Math.max(0, Math.ceil(duration - elapsed));
          document.getElementById('step' + stepIndex + 'Timer').textContent = formatTime(stepRemaining[stepIndex]);
          if (stepRemaining[stepIndex] <= 0) {
            completeStep(stepIndex);
          }
        }, 200);
        renderSteps();
      } else if (state === 'running') {
        // Manual skip / early complete
        completeStep(stepIndex);
      }
      // locked or completed: do nothing
    }

    // Attach step click handlers
    for (let i = 0; i < STEP_COUNT; i++) {
      document.getElementById('step' + i).addEventListener('click', () => handleStepClick(i));
    }

    // Reset brew button
    btnResetBrew.addEventListener('click', () => {
      if (selectedRecipe) {
        resetBrewState();
      }
    });

    // --- Slider events ---
    slider.addEventListener('input', handleSliderInput);
    btnResetRatio.addEventListener('click', resetRatio);

    // --- Init ---
    handleSliderInput();
  </script>
</body>
</html>
